<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title></title>
	<meta name="keywords" content="" />
	<meta name="description" content="" />
	<link href="css/MazeGen.css" rel="stylesheet">

</head>

<body>
	<div>

		<div style="position: relative;">
 <canvas id="mazecanvas" width="640" height="480"
   style="position: absolute; left: 0; top: 0; z-index: 0;"></canvas>
 <canvas id="movingcanvas" width="640" height="480"
   style="position: absolute; left: 0; top: 0; z-index: 1;"></canvas>
</div>
<script type="text/javascript" src="js/MazeWorldModel.js"></script>
<script type= "text/javascript" src="js/game.js"></script>
<script type= "text/javascript" src="js/Renderer.js"></script>

	  <ul>
	    <li><label>Width:</label><input id=width type="text"/></li>
	    <li><label>Height:</label><input id=height type="text"/></li>
	    <li><label>Path Width:</label><input id=pathwidth type="text"/></li>
	    <li><label>Wall Width:</label><input id=wallwidth type="text"/></li>
	    <li><label>Outer Width:</label><input id=outerwidth type="text"/></li>
	    <li><label>Path Color:</label><input id=pathcolor type="text"/></li>
	    <li><label>Wall Color:</label><input id=wallcolor type="text"/></li>
	    <li><label>Seed:</label><input id=seed type="text"/></li>
	    <li><input id=randomseed type="button" value="Random Seed"/></li>
	  </ul>
	</div>

<script type="text/javascript">
MazeWorldModel.init();


blockPercentage = function(percentage)
{
	for (var i = 0; i < height * 2; i++)
	{
		for (var j = 0; j < width * 2; j++)
		{
			var random_boolean = Math.random() >= 1-percentage;
			map[i][j] = random_boolean;
		}
	}
}

ConsolePrintMap = function()
{
	var row = "";
	console.log("Map size is ", width, "X",height);
	for (var i = 0; i < height * 2; i++)
	{
		for (var j = 0; j < width * 2; j++)
		{
			if (MazeWorldModel.map[i][j] === true)
			  row = row.concat(" ");
			else
				row = row.concat("#");
		}
		console.log(row);
		row= "";
	}
}




inputWidth = document.getElementById("width");
inputHeight = document.getElementById("height");
inputPathWidth = document.getElementById("pathwidth");
inputWallWidth = document.getElementById("wallwidth");
inputOuterWidth = document.getElementById("outerwidth");
inputPathColor = document.getElementById("pathcolor");
inputWallColor = document.getElementById("wallcolor");
inputSeed = document.getElementById("seed");
buttonRandomSeed = document.getElementById("randomseed");

settings =
{
  display: function()
	{
    inputWidth.value = MazeWorldModel.width;
    inputHeight.value = MazeWorldModel.height;
    inputPathWidth.value = MazeWorldModel.pathWidth;
    inputWallWidth.value = MazeWorldModel.wall;
    inputOuterWidth.value = MazeWorldModel.outerWall;
    inputPathColor.value = MazeWorldModel.pathColor;
    inputWallColor.value = MazeWorldModel.wallColor;
    inputSeed.value = MazeWorldModel.seed;
  },
  check: function()
	{
    if ( inputWidth.value != width ||
      inputHeight.value != height ||
      inputPathWidth.value != pathWidth ||
      inputWallWidth.value != wall ||
      inputOuterWidth.value != outerWall ||
      inputPathColor.value != pathColor ||
      inputWallColor.value != wallColor ||
      inputSeed.value != seed )
		{
      settings.update();
    }
  },
  update: function()
	{
    clearTimeout(timer);
    width = parseFloat(inputWidth.value);
    height = parseFloat(inputHeight.value);
    pathWidth = parseFloat(inputPathWidth.value);
    wall = parseFloat(inputWallWidth.value);
    outerWall = parseFloat(inputOuterWidth.value);
    pathColor = inputPathColor.value;
    wallColor = inputWallColor.value;
    seed = parseFloat(inputSeed.value);
    x = (width / 2) | 0;
    y = (height / 2) | 0;
    MazeWorldModel.init();
    MazeWorldModel.loop();
  }
};

buttonRandomSeed.addEventListener("click", function()
{
  inputSeed.value = (Math.random() * 100000) | 0;
});


settings.display();
MazeWorldModel.loop();

setInterval(settings.check, 400);

// --------------------------------------------------------
// End of the generation part -----------------------------
// --------------------------------------------------------
//

//Draw the game board
function draw(wm)
{
		var canvas = document.getElementById("movingcanvas");
		var width = canvas.width;

		var boardlength = wm.GetBoardLength();
		var boardwidith = wm.GetBoardWidth();

		var blockSize = width/ boardlength;
		var ctx = canvas.getContext('2d');
		ctx.setTransform(1, 0, 0, 1, 0, 0);
		ctx.clearRect(0, 0, width, width);
		ctx.fillStyle="white";

    //Draw the player
    ctx.beginPath();
    var half = blockSize/2;
    ctx.fillStyle = "blue";
    ctx.arc(wm.GetPlayerX()*blockSize+half,wm.GetPlayerY()*blockSize+half, half, 0, 2*Math.PI);
    if (el('#R_X') != null )
      el('#R_X').innerHTML ="0";
    if (el('#R_Y') != null )
      el('#R_Y').innerHTML ="0";
    if (el('#L_X') != null )
      el('#L_X').innerHTML = wm.player.x;
    if (el('#L_Y') != null )
      el('#L_Y').innerHTML = wm.player.y;
    ctx.fill();
}


</script>



</body>
